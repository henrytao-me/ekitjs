var fs = require('fs');
var path = require('path');

exports.subdirs = function(dir) {
	var res = [];
	try {
		var tmp = fs.readdirSync(dir);
		for(var i in tmp) {
			if(fs.lstatSync(path.join(dir, tmp[i])).isDirectory()) {
				res.push(tmp[i]);
			};
		};
	} catch(ex) {
		return res;
	};
	return res;
};

exports.subdirs_tmp = function(dir, callback) {
	var res = [];
	var pending = 0;
	var done = function() {
		return callback(null, res);
	};
	var getStatHandler = function(file) {
		return function(err, stat) {
			if(stat.isDirectory()) {
				res.push(file);
			};
			if(!--pending) {
				return done();
			};
		};
	};
	fs.readdir(dir, function(err, list) {
		if(err) {
			return callback(err, []);
		};
		pending = list.length;
		if(!pending) {
			return done();
		};
		for(var file, i = 0, l = list.length; i < l; i++) {
			file = path.join(dir, list[i]);
			fs.stat(file, getStatHandler(file));
		};
	});
};

