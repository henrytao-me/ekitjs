var GLOBAL=this;String.prototype.replaceAll=function(t,e,n){var i,c=this+"",s=-1;if("string"==typeof t){if(!n)return this.split(t).join(e);for(i=t.toLowerCase();-1!==(s=c.toLowerCase().indexOf(t,s>=0?s+e.length:0));)c=c.substring(0,s)+e+c.substring(s+t.length)}return c},Object.prototype.watch||Object.defineProperty(Object.prototype,"watch",{enumerable:!1,configurable:!0,writable:!1,value:function(t,e){var n=this[t],i=n,c=function(){return i},s=function(c){return n=i,i=e.call(this,t,n,c)};delete this[t]&&Object.defineProperty(this,t,{get:c,set:s,enumerable:!0,configurable:!0})}}),Object.prototype.unwatch||Object.defineProperty(Object.prototype,"unwatch",{enumerable:!1,configurable:!0,writable:!1,value:function(t){var e=this[t];delete this[t],this[t]=e}}),_.___each=_.each,_.each=function(t,e,n,i){var c=0,s=0;try{_.isArray(t)&&(c=t.length),_.isObject(t,!0)&&(c=Object.keys(t).length)}catch(a){}var r=function(t,n,a){s++,e.call(i,t,n,a,{index:s-1,isLast:s>=c?!0:!1})};_.___each(t,r,n)},_.initObject=function(t,e,n){_.each(e,function(e){void 0===t[e]?t[e]=n:null})},_.___isObject=_.isObject,_.isObject=function(t,e){return e===!0?!_.___isObject(t)||_.isArray(t)||_.isFunction(t)?!1:!0:_.___isObject(t)},_.getObject=function(obj,key){_.isArray(key)&&(key=key.join("."));var res=void 0;try{res=eval("obj."+key)}catch(ex){}return res},_.setObject=function(t,e,n){if(!_.isObject(t,!0))return!1;void 0===n?n=!1:null;try{_.each(e,function(e,i){!function(t,e,i){var c=e.shift();if(0===e.length){if(_.isObject(t[c],!0))throw{func:"setObject",msg:"unmatch structure"};(n||void 0===t[c])&&(t[c]=i)}else{if(void 0===t[c]&&(t[c]={}),!_.isObject(t[c],!0))throw{func:"setObject",msg:"unmatch structure"};arguments.callee(t[c],e,i)}}(t,i.split("."),e)})}catch(i){return!1}return!0},_.mixObject=function(t,e,n,i){return _.isObject(t,!0)?_.isObject(e,!0)?(_.setObject(t,_.encodeObject(e,i),n),!0):!1:!1},_.initCallback=function(t,e){var n=[];void 0===e?e=function(){}:null;try{var i=!1;_.each(t,function(t,e,c,s){n.push(t),s.isLast===!0&&_.isFunction(t)===!0&&(i=!0)}),i!==!0&&n.push(e)}catch(c){}return n},_.sortObject=function(t,e,n){if(_.isArray(t))t.sort(function(t,i){return e.call(n,t,i)});else{var i=[];_.each(t,function(t,e){i.push({key:e,value:t})}),_.sortObject(i,function(t,n){return e(t.value,n.value)},n),_.each(t,function(e,n){delete t[n]}),_.each(i,function(e){t[e.key]=e.value})}},_.encodeObject=function(t,e){var n={};return function(t,n,i){var c=arguments.callee;_.each(n,function(n,s){_.isObject(n,!0)&&void 0===n[e]?void 0===i?c(t,n,s):c(t,n,[i,s].join(".")):void 0===i?t[s]=n:t[[i,s].join(".")]=n})}(n,t),n},_.decodeObject=function(t){var e={};return _.setObject(e,t)===!1?null:e},_.success=function(t,e,n){var i=function(t,e,n){count=0,this.success=function(){count++,t>count||_.isFunction(e)&&e.call(n)}};return new i(t,e,n)},function(t){var e=!1,n=/xyz/.test(function(){})?/\b_super\b/:/.*/;t.Class=function(){},t.Class.extend=function(){function i(){if(this.constructor!==t.Class)throw new Error("You can only instanciate objects with the 'new' operator");if(!e&&this.init){var n=this.init.apply(this,arguments);if(n)return n}return _.each(this.__keys,function(t,e){_.isFunction(this[e])&&(this[e].self=this)},void 0,this),this}var c=this.prototype,s=_.toArray(arguments);s.unshift({});var a=_.extend.apply(_,s);e=!0;var r=new this;e=!1,r.__class=!0,r.__keys||(r.__keys={});for(var o in a)r.__keys[o]=(r.__keys[o]||0)+1,r[o]="function"==typeof a[o]&&n.test(a[o])?function(t,e){return function(){var n=this._super;this._super=c[t];var i=e.apply(this,arguments);return this._super=n,i}}(o,a[o]):a[o];return i.include=function(t){for(var e in t)"function"==typeof t[e]&&n.test(t[e])?"function"==typeof r[e]&&r.hasOwnProperty(e)?r[e]=function(t,e,n){return function(){var t=this._super;this._super=n;var i=e.apply(this,arguments);return this._super=t,i}}(e,t[e],r[e]):"function"==typeof c[e]&&(r[e]=function(t,e){return function(){var n=this._super;this._super=c[t];var i=e.apply(this,arguments);return this._super=n,i}}(e,t[e])):r[e]=t[e]},i.prototype=r,i.constructor=i,i.extend=arguments.callee,"undefined"!=typeof this.extend&&(i.extend=this.extend),i.__class=!0,i}}(GLOBAL);var Socket=Class.extend({http:"http://localhost",socket:null,key:0,callback:{},callbackSync:{},init:function(t){var e=this;this.http=t,this.socket=io.connect(this.http),this.socket.on("socket.server",function(t){var n=e.callback[t.key].callback;_.isFunction(n)&&n(t.e,t.data)}),this.socket.on("socket.server.sync",function(t){try{_.each(e.callbackSync[t.instance],function(t){e.socket.emit("socket.client",{type:t.type,instance:t.instance,func:t.func,args:t.args,key:t.key})},void 0,this)}catch(n){}})},getKey:function(){return this.key++},register:function(t){_.mixObject(t,{type:"pool",instance:null,func:null,args:[],key:this.getKey(),callback:function(){}}),this.callback[t.key]=t,"sync"===t.type&&(void 0===this.callbackSync[t.instance]?this.callbackSync[t.instance]=[]:null,this.callbackSync[t.instance].push(t)),this.socket.emit("socket.client",{type:t.type,instance:t.instance,func:t.func,args:t.args,key:t.key})}}),ekitjs=Class.extend({data:null,socket:null,instance:{},instanceSync:{},start:function(t){_.mixObject(t,{instance:{},http:"http://localhost"}),this.instance={},this.instanceSync={},_.each(_.encodeObject(t.instance),function(t,e){e=e.split(".");var n=e.pop();e=e.join("."),void 0===this.instance[e]?this.instance[e]={}:null,void 0===this.instanceSync[e]?this.instanceSync[e]={}:null,this.instance[e][n]=!0,this.instanceSync[e][n]=!0},void 0,this),this.socket=new Socket(t.http),this.setInstance()},setInstance:function(){var t=this;_.each(this.instance,function(e,n){_.each(e,function(i,c){e[c]=function(e,n){return function(){var i=_.initCallback(arguments),c=i.pop();t.socket.register({type:"pool",instance:e,func:n,args:i,callback:c})}}(n,c)},void 0,this)},void 0,this),_.each(this.instanceSync,function(e,n){_.each(e,function(i,c){e[c]=function(e,n){return function(){var i=_.initCallback(arguments),c=i.pop();t.socket.register({type:"sync",instance:e,func:n,args:i,callback:c})}}(n,c)},void 0,this)},void 0,this)},pool:function(t,e){if(void 0===e)return this.instance[t];try{var n=_.initCallback(arguments);t=n.shift(),e=n.shift(),this.instance[t][e].apply(this.instance[t][e],n)}catch(i){console.log("pool call error: ",i),console.log(arguments)}},sync:function(t,e){if(void 0===e)return this.instanceSync[t];try{var n=_.initCallback(arguments);t=n.shift(),e=n.shift(),this.instanceSync[t][e].apply(this.instanceSync[t][e],n)}catch(i){console.log("sync call error: ","Unknow instance or method",i),console.log(arguments)}}});ekitjs=new ekitjs,ekitjs.data={instance:{get:{},"model.document":{log:!0,getCollection:!0,getDB:!0,createValidate:!0,checkUpdateKey:!0,updateValidate:!0,create:!0,read:!0,update:!0,"delete":!0,createTrigger:!0,updateTrigger:!0,deleteTrigger:!0},"model.folder":{log:!0,getCollection:!0,getDB:!0,createValidate:!0,checkUpdateKey:!0,updateValidate:!0,create:!0,read:!0,update:!0,"delete":!0,createTrigger:!0,updateTrigger:!0,deleteTrigger:!0},"model.sheet":{log:!0,getCollection:!0,getDB:!0,createValidate:!0,checkUpdateKey:!0,updateValidate:!0,create:!0,read:!0,update:!0,"delete":!0,createTrigger:!0,updateTrigger:!0,deleteTrigger:!0,createDefault:!0,getColumn:!0},"web.controller.index":{log:!0,"export":!0}},http:"http://localhost"},ekitjs.start(ekitjs.data);