var GLOBAL=this;String.prototype.replaceAll=function(t,n,e){var i,c=this+"",s=-1;if("string"==typeof t){if(!e)return this.split(t).join(n);for(i=t.toLowerCase();-1!==(s=c.toLowerCase().indexOf(t,s>=0?s+n.length:0));)c=c.substring(0,s)+n+c.substring(s+t.length)}return c},Object.prototype.watch||Object.defineProperty(Object.prototype,"watch",{enumerable:!1,configurable:!0,writable:!1,value:function(t,n){var e=this[t],i=e,c=function(){return i},s=function(c){return e=i,i=n.call(this,t,e,c)};delete this[t]&&Object.defineProperty(this,t,{get:c,set:s,enumerable:!0,configurable:!0})}}),Object.prototype.unwatch||Object.defineProperty(Object.prototype,"unwatch",{enumerable:!1,configurable:!0,writable:!1,value:function(t){var n=this[t];delete this[t],this[t]=n}}),_.___each=_.each,_.each=function(t,n,e,i){var c=0,s=0;try{_.isArray(t)&&(c=t.length),_.isObject(t,!0)&&(c=Object.keys(t).length)}catch(a){}var r=function(t,e,a){s++,n.call(i,t,e,a,{index:s-1,isLast:s>=c?!0:!1})};_.___each(t,r,e)},_.___isObject=_.isObject,_.isObject=function(t,n){return n===!0?!_.___isObject(t)||_.isArray(t)||_.isFunction(t)?!1:!0:_.___isObject(t)},_.getObject=function(obj,key){_.isArray(key)&&(key=key.join("."));var res=void 0;try{res=eval("obj."+key)}catch(ex){}return res},_.setObject=function(t,n,e){if(!_.isObject(t,!0))return!1;void 0===e?e=!1:null;try{_.each(n,function(n,i){!function(t,n,i){var c=n.shift();if(0===n.length){if(_.isObject(t[c],!0))throw{func:"setObject",msg:"unmatch structure"};(e||void 0===t[c])&&(t[c]=i)}else{if(void 0===t[c]&&(t[c]={}),!_.isObject(t[c],!0))throw{func:"setObject",msg:"unmatch structure"};arguments.callee(t[c],n,i)}}(t,i.split("."),n)})}catch(i){return!1}return!0},_.mixObject=function(t,n,e,i){return _.isObject(t,!0)?_.isObject(n,!0)?(_.setObject(t,_.encodeObject(n,i),e),!0):!1:!1},_.initCallback=function(t,n){var e=[];void 0===n?n=function(){}:null;try{var i=!1;_.each(t,function(t,n,c,s){e.push(t),s.isLast===!0&&_.isFunction(t)===!0&&(i=!0)}),i!==!0&&e.push(n)}catch(c){}return e},_.sortObject=function(t,n,e){if(_.isArray(t))t.sort(function(t,i){return n.call(e,t,i)});else{var i=[];_.each(t,function(t,n){i.push({key:n,value:t})}),_.sortObject(i,function(t,e){return n(t.value,e.value)},e),_.each(t,function(n,e){delete t[e]}),_.each(i,function(n){t[n.key]=n.value})}},_.encodeObject=function(t,n){var e={};return function(t,e,i){var c=arguments.callee;_.each(e,function(e,s){_.isObject(e,!0)&&void 0===e[n]?void 0===i?c(t,e,s):c(t,e,[i,s].join(".")):void 0===i?t[s]=e:t[[i,s].join(".")]=e})}(e,t),e},_.decodeObject=function(t){var n={};return _.setObject(n,t)===!1?null:n},_.success=function(t,n,e){var i=function(t,n,e){count=0,this.success=function(){count++,t>count||_.isFunction(n)&&n.call(e)}};return new i(t,n,e)},function(t){var n=!1,e=/xyz/.test(function(){})?/\b_super\b/:/.*/;t.Class=function(){},t.Class.extend=function(){function i(){if(this.constructor!==t.Class)throw new Error("You can only instanciate objects with the 'new' operator");if(!n&&this.init){var e=this.init.apply(this,arguments);if(e)return e}return _.each(this.__keys,function(t,n){_.isFunction(this[n])&&(this[n].self=this)},void 0,this),this}var c=this.prototype,s=_.toArray(arguments);s.unshift({});var a=_.extend.apply(_,s);n=!0;var r=new this;n=!1,r.__class=!0,r.__keys||(r.__keys={});for(var o in a)r.__keys[o]=(r.__keys[o]||0)+1,r[o]="function"==typeof a[o]&&e.test(a[o])?function(t,n){return function(){var e=this._super;this._super=c[t];var i=n.apply(this,arguments);return this._super=e,i}}(o,a[o]):a[o];return i.include=function(t){for(var n in t)"function"==typeof t[n]&&e.test(t[n])?"function"==typeof r[n]&&r.hasOwnProperty(n)?r[n]=function(t,n,e){return function(){var t=this._super;this._super=e;var i=n.apply(this,arguments);return this._super=t,i}}(n,t[n],r[n]):"function"==typeof c[n]&&(r[n]=function(t,n){return function(){var e=this._super;this._super=c[t];var i=n.apply(this,arguments);return this._super=e,i}}(n,t[n])):r[n]=t[n]},i.prototype=r,i.constructor=i,i.extend=arguments.callee,"undefined"!=typeof this.extend&&(i.extend=this.extend),i.__class=!0,i}}(GLOBAL);var Socket=Class.extend({http:"http://localhost",socket:null,key:0,callback:{},callbackSync:{},init:function(t){var n=this;this.http=t,this.socket=io.connect(this.http),this.socket.on("socket.server",function(t){var e=n.callback[t.key].callback;_.isFunction(e)&&e(t.e,t.data)}),this.socket.on("socket.server.sync",function(t){try{_.each(n.callbackSync[t.instance],function(t){n.socket.emit("socket.client",{type:t.type,instance:t.instance,func:t.func,args:t.args,key:t.key})},void 0,this)}catch(e){}})},getKey:function(){return this.key++},register:function(t){_.mixObject(t,{type:"pool",instance:null,func:null,args:[],key:this.getKey(),callback:function(){}}),this.callback[t.key]=t,"sync"===t.type&&(void 0===this.callbackSync[t.instance]?this.callbackSync[t.instance]=[]:null,this.callbackSync[t.instance].push(t)),this.socket.emit("socket.client",{type:t.type,instance:t.instance,func:t.func,args:t.args,key:t.key})}}),ekitjs=Class.extend({data:null,socket:null,instance:{},instanceSync:{},start:function(t){_.mixObject(t,{instance:{},http:"http://localhost"}),this.instance={},this.instanceSync={},_.each(_.encodeObject(t.instance),function(t,n){n=n.split(".");var e=n.pop();n=n.join("."),void 0===this.instance[n]?this.instance[n]={}:null,void 0===this.instanceSync[n]?this.instanceSync[n]={}:null,this.instance[n][e]=!0,this.instanceSync[n][e]=!0},void 0,this),this.socket=new Socket(t.http),this.setInstance()},setInstance:function(){var t=this;_.each(this.instance,function(n,e){_.each(n,function(i,c){n[c]=function(n,e){return function(){var i=_.initCallback(arguments),c=i.pop();t.socket.register({type:"pool",instance:n,func:e,args:i,callback:c})}}(e,c)},void 0,this)},void 0,this),_.each(this.instanceSync,function(n,e){_.each(n,function(i,c){n[c]=function(n,e){return function(){var i=_.initCallback(arguments),c=i.pop();t.socket.register({type:"sync",instance:n,func:e,args:i,callback:c})}}(e,c)},void 0,this)},void 0,this)},pool:function(t,n){if(void 0===n)return this.instance[t];try{var e=_.initCallback(arguments);t=e.shift(),n=e.shift(),this.instance[t][n].apply(this.instance[t][n],e)}catch(i){console.log("pool call error: ",i),console.log(arguments)}},sync:function(t,n){if(void 0===n)return this.instanceSync[t];try{var e=_.initCallback(arguments);t=e.shift(),n=e.shift(),this.instanceSync[t][n].apply(this.instanceSync[t][n],e)}catch(i){console.log("sync call error: ","Unknow instance or method",i),console.log(arguments)}}});ekitjs=new ekitjs,ekitjs.data={instance:{get:{},"web.controller.index":{log:!0,"export":!0}},http:"http://localhost"},ekitjs.start(ekitjs.data);