var GLOBAL=this;String.prototype.replaceAll=function(e,t,n){var i,c=this+"",r=-1;if("string"==typeof e){if(!n)return this.split(e).join(t);for(i=e.toLowerCase();-1!==(r=c.toLowerCase().indexOf(e,r>=0?r+t.length:0));)c=c.substring(0,r)+t+c.substring(r+e.length)}return c},Object.prototype.watch||Object.defineProperty(Object.prototype,"watch",{enumerable:!1,configurable:!0,writable:!1,value:function(e,t){var n=this[e],i=n,c=function(){return i},r=function(c){return n=i,i=t.call(this,e,n,c)};delete this[e]&&Object.defineProperty(this,e,{get:c,set:r,enumerable:!0,configurable:!0})}}),Object.prototype.unwatch||Object.defineProperty(Object.prototype,"unwatch",{enumerable:!1,configurable:!0,writable:!1,value:function(e){var t=this[e];delete this[e],this[e]=t}}),_.___each=_.each,_.each=function(e,t,n,i){var c=0,r=0;try{_.isArray(e)&&(c=e.length),_.isObject(e,!0)&&(c=Object.keys(e).length)}catch(s){}var a=function(e,n,s){r++,t.call(i,e,n,s,{index:r-1,isLast:r>=c?!0:!1})};_.___each(e,a,n)},_.initObject=function(e,t,n){_.each(t,function(t){void 0===e[t]?e[t]=n:null})},_.___isObject=_.isObject,_.isObject=function(e,t){return t===!0?!_.___isObject(e)||_.isArray(e)||_.isFunction(e)?!1:!0:_.___isObject(e)},_.getObject=function(obj,key){_.isArray(key)&&(key=key.join("."));var res=void 0;try{res=eval("obj."+key)}catch(ex){}return res},_.setObject=function(e,t,n){if(!_.isObject(e,!0))return!1;void 0===n?n=!1:null;try{_.each(t,function(t,i){!function(e,t,i){var c=t.shift();if(0===t.length){if(_.isObject(e[c],!0))throw{func:"setObject",msg:"unmatch structure"};(n||void 0===e[c])&&(e[c]=i)}else{if(void 0===e[c]&&(e[c]={}),!_.isObject(e[c],!0))throw{func:"setObject",msg:"unmatch structure"};arguments.callee(e[c],t,i)}}(e,i.split("."),t)})}catch(i){return!1}return!0},_.mixObject=function(e,t,n,i){return _.isObject(e,!0)?_.isObject(t,!0)?(_.setObject(e,_.encodeObject(t,i),n),!0):!1:!1},_.initCallback=function(e,t){var n=[];void 0===t?t=function(){}:null;try{var i=!1;_.each(e,function(e,t,c,r){n.push(e),r.isLast===!0&&_.isFunction(e)===!0&&(i=!0)}),i!==!0&&n.push(t)}catch(c){}return n},_.sortObject=function(e,t,n){if(_.isArray(e))e.sort(function(e,i){return t.call(n,e,i)});else{var i=[];_.each(e,function(e,t){i.push({key:t,value:e})}),_.sortObject(i,function(e,n){return t(e.value,n.value)},n),_.each(e,function(t,n){delete e[n]}),_.each(i,function(t){e[t.key]=t.value})}},_.encodeObject=function(e,t){var n={};return function(e,n,i){var c=arguments.callee;_.each(n,function(n,r){_.isObject(n,!0)&&void 0===n[t]?void 0===i?c(e,n,r):c(e,n,[i,r].join(".")):void 0===i?e[r]=n:e[[i,r].join(".")]=n})}(n,e),n},_.decodeObject=function(e){var t={};return _.setObject(t,e)===!1?null:t},_.success=function(e,t,n){var i=function(e,t,n){count=0,this.success=function(){count++,e>count||_.isFunction(t)&&t.call(n)}};return new i(e,t,n)},function(e){var t=!1,n=/xyz/.test(function(){})?/\b_super\b/:/.*/;e.Class=function(){},e.Class.extend=function(){function i(){if(this.constructor!==e.Class)throw new Error("You can only instanciate objects with the 'new' operator");if(!t&&this.init){var n=this.init.apply(this,arguments);if(n)return n}return _.each(this.__keys,function(e,t){_.isFunction(this[t])&&(this[t].self=this)},void 0,this),this}var c=this.prototype,r=_.toArray(arguments);r.unshift({});var s=_.extend.apply(_,r);t=!0;var a=new this;t=!1,a.__class=!0,a.__keys||(a.__keys={});for(var o in s)a.__keys[o]=a.__keys[o]||{},a.__keys[o].n=(a.__keys[o].n||0)+1,a.__keys[o].type=typeof s[o],a[o]="function"==typeof s[o]&&n.test(s[o])?function(e,t){return function(){var n=this._super;this._super=c[e];var i=t.apply(this,arguments);return this._super=n,i}}(o,s[o]):s[o];return i.include=function(e){for(var t in e)a.__keys[t]=a.__keys[t]||{},a.__keys[t].n=(a.__keys[t].n||0)+1,a.__keys[t].type=typeof e[t],"function"==typeof e[t]&&n.test(e[t])?"function"==typeof a[t]&&a.hasOwnProperty(t)?a[t]=function(e,t,n){return function(){var e=this._super;this._super=n;var i=t.apply(this,arguments);return this._super=e,i}}(t,e[t],a[t]):"function"==typeof c[t]&&(a[t]=function(e,t){return function(){var n=this._super;this._super=c[e];var i=t.apply(this,arguments);return this._super=n,i}}(t,e[t])):a[t]=e[t]},i.prototype=a,i.constructor=i,i.extend=arguments.callee,"undefined"!=typeof this.extend&&(i.extend=this.extend),i.__class=!0,i.__keys=a.__keys,i}}(GLOBAL);var Socket=Class.extend({http:"http://localhost",socket:null,key:0,callback:{},callbackSync:{},init:function(e){var t=this;this.http=e,this.socket=io.connect(this.http),this.socket.on("socket.server",function(e){var n=t.callback[e.key].callback;_.isFunction(n)&&n(e.e,e.data)}),this.socket.on("socket.server.sync",function(e){try{_.each(t.callbackSync[e.instance],function(e){t.socket.emit("socket.client",{type:e.type,instance:e.instance,func:e.func,args:e.args,key:e.key})},void 0,this)}catch(n){}})},getKey:function(){return this.key++},register:function(e){_.mixObject(e,{type:"pool",instance:null,func:null,args:[],key:this.getKey(),callback:function(){}}),this.callback[e.key]=e,"sync"===e.type&&(void 0===this.callbackSync[e.instance]?this.callbackSync[e.instance]=[]:null,this.callbackSync[e.instance].push(e)),this.socket.emit("socket.client",{type:e.type,instance:e.instance,func:e.func,args:e.args,key:e.key})}}),ekitjs=Class.extend({data:null,socket:null,instance:{},instanceSync:{},start:function(e){_.mixObject(e,{instance:{},http:"http://localhost"}),this.instance={},this.instanceSync={},_.each(_.encodeObject(e.instance),function(e,t){t=t.split(".");var n=t.pop();t=t.join("."),void 0===this.instance[t]?this.instance[t]={}:null,void 0===this.instanceSync[t]?this.instanceSync[t]={}:null,this.instance[t][n]=!0,this.instanceSync[t][n]=!0},void 0,this),this.socket=new Socket(e.http),this.setInstance()},setInstance:function(){var e=this;_.each(this.instance,function(t,n){_.each(t,function(i,c){t[c]=function(t,n){return function(){var i=_.initCallback(arguments),c=i.pop();e.socket.register({type:"pool",instance:t,func:n,args:i,callback:c})}}(n,c)},void 0,this)},void 0,this),_.each(this.instanceSync,function(t,n){_.each(t,function(i,c){t[c]=function(t,n){return function(){var i=_.initCallback(arguments),c=i.pop();e.socket.register({type:"sync",instance:t,func:n,args:i,callback:c})}}(n,c)},void 0,this)},void 0,this)},pool:function(e,t){if(void 0===t)return this.instance[e];try{var n=_.initCallback(arguments);e=n.shift(),t=n.shift(),this.instance[e][t].apply(this.instance[e][t],n)}catch(i){console.log("pool call error: ",i),console.log(arguments)}},sync:function(e,t){if(void 0===t)return this.instanceSync[e];try{var n=_.initCallback(arguments);e=n.shift(),t=n.shift(),this.instanceSync[e][t].apply(this.instanceSync[e][t],n)}catch(i){console.log("sync call error: ","Unknow instance or method",i),console.log(arguments)}}});ekitjs=new ekitjs,ekitjs.data={instance:{get:{},"model.document":{log:!0,"export":!0,getCollection:!0,getDB:!0,createValidate:!0,checkUpdateKey:!0,updateValidate:!0,create:!0,read:!0,update:!0,"delete":!0,createTrigger:!0,updateTrigger:!0,deleteTrigger:!0,__createTrigger:!0,__updateTrigger:!0,__deleteTrigger:!0,__beforeDelete:!0,getInstance:!0,socketClient:!0,getInfo:!0,createDefault:!0,getColumn:!0},"model.folder":{log:!0,"export":!0,getCollection:!0,getDB:!0,createValidate:!0,checkUpdateKey:!0,updateValidate:!0,create:!0,read:!0,update:!0,"delete":!0,createTrigger:!0,updateTrigger:!0,deleteTrigger:!0,__createTrigger:!0,__updateTrigger:!0,__deleteTrigger:!0,__beforeDelete:!0,getInstance:!0,socketClient:!0,getInfo:!0,createDefault:!0,getColumn:!0},"model.sheet":{log:!0,"export":!0,getCollection:!0,getDB:!0,createValidate:!0,checkUpdateKey:!0,updateValidate:!0,create:!0,read:!0,update:!0,"delete":!0,createTrigger:!0,updateTrigger:!0,deleteTrigger:!0,__createTrigger:!0,__updateTrigger:!0,__deleteTrigger:!0,__beforeDelete:!0,getInstance:!0,socketClient:!0,getInfo:!0,createDefault:!0,getColumn:!0},"web.controller.index":{log:!0,"export":!0,getCollection:!0,getDB:!0,createValidate:!0,checkUpdateKey:!0,updateValidate:!0,create:!0,read:!0,update:!0,"delete":!0,createTrigger:!0,updateTrigger:!0,deleteTrigger:!0,__createTrigger:!0,__updateTrigger:!0,__deleteTrigger:!0,__beforeDelete:!0,getInstance:!0,socketClient:!0,getInfo:!0,createDefault:!0,getColumn:!0}},http:"http://localhost"},ekitjs.start(ekitjs.data);