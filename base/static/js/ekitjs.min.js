var GLOBAL=this;String.prototype.replaceAll=function(t,e,n){var i,s=this+"",c=-1;if("string"==typeof t){if(!n)return this.split(t).join(e);for(i=t.toLowerCase();-1!==(c=s.toLowerCase().indexOf(t,c>=0?c+e.length:0));)s=s.substring(0,c)+e+s.substring(c+t.length)}return s},Object.prototype.watch||Object.defineProperty(Object.prototype,"watch",{enumerable:!1,configurable:!0,writable:!1,value:function(t,e){var n=this[t],i=n,s=function(){return i},c=function(s){return n=i,i=e.call(this,t,n,s)};delete this[t]&&Object.defineProperty(this,t,{get:s,set:c,enumerable:!0,configurable:!0})}}),Object.prototype.unwatch||Object.defineProperty(Object.prototype,"unwatch",{enumerable:!1,configurable:!0,writable:!1,value:function(t){var e=this[t];delete this[t],this[t]=e}}),_.___each=_.each,_.each=function(t,e,n,i){var s=0,c=0;try{_.isArray(t)&&(s=t.length),_.isObject(t,!0)&&(s=Object.keys(t).length)}catch(a){}var o=function(t,n,a){c++,e.call(i,t,n,a,{index:c-1,isLast:c>=s?!0:!1,isFirst:1===c?!0:!1})};_.___each(t,o,n)},_.initObject=function(t,e,n){_.each(e,function(e){void 0===t[e]?t[e]=n:null})},_.___isObject=_.isObject,_.isObject=function(t,e){return e===!0?!_.___isObject(t)||_.isArray(t)||_.isFunction(t)?!1:!0:_.___isObject(t)},_.getObject=function(obj,key){_.isArray(key)&&(key=key.join("."));var res=void 0;try{res=eval("obj."+key)}catch(ex){}return res},_.setObject=function(t,e,n){if(!_.isObject(t,!0))return!1;void 0===n?n=!1:null;try{_.each(e,function(e,i){!function(t,e,i){var s=e.shift();if(0===e.length){if(_.isObject(t[s],!0))throw{func:"setObject",msg:"unmatch structure"};(n||void 0===t[s])&&(t[s]=i)}else{if(void 0===t[s]&&(t[s]={}),!_.isObject(t[s],!0))throw{func:"setObject",msg:"unmatch structure"};arguments.callee(t[s],e,i)}}(t,i.split("."),e)})}catch(i){return!1}return!0},_.mixObject=function(t,e,n,i){return _.isObject(t,!0)?_.isObject(e,!0)?(_.setObject(t,_.encodeObject(e,i),n),!0):!1:!1},_.initCallback=function(t,e){var n=[];void 0===e?e=function(){}:null;try{var i=!1;_.each(t,function(t,e,s,c){n.push(t),c.isLast===!0&&_.isFunction(t)===!0&&(i=!0)}),i!==!0&&n.push(e)}catch(s){}return n},_.sequence=function(t,e){0===t.length?e():function(t){var n=arguments,i=t.shift();0===t.length?i(e):i(function(){n.callee(t)})}(t)},_.sortObject=function(t,e,n){if(_.isArray(t))t.sort(function(t,i){return e.call(n,t,i)});else{var i=[];_.each(t,function(t,e){i.push({key:e,value:t})}),_.sortObject(i,function(t,n){return e(t.value,n.value)},n),_.each(t,function(e,n){delete t[n]}),_.each(i,function(e){t[e.key]=e.value})}},_.encodeObject=function(t,e){var n={};return function(t,n,i){var s=arguments.callee;_.each(n,function(n,c){_.isObject(n,!0)&&void 0===n[e]?void 0===i?s(t,n,c):s(t,n,[i,c].join(".")):void 0===i?t[c]=n:t[[i,c].join(".")]=n})}(n,t),n},_.decodeObject=function(t){var e={};return _.setObject(e,t)===!1?null:e},_.success=function(t,e,n){var i=function(t,e,n){count=0,this.success=function(){count++,t>count||_.isFunction(e)&&(n?e.call(n):e())}};return new i(t,e,n)},function(t){var e=!1,n=/xyz/.test(function(){})?/\b_super\b/:/.*/;t.Class=function(){},t.Class.extend=function(){function i(){if(this.constructor!==t.Class)throw new Error("You can only instanciate objects with the 'new' operator");if(!e&&this.init){var n=this.init.apply(this,arguments);if(n)return n}return _.each(this.__keys,function(t,e){_.isFunction(this[e])&&(this[e].self=this)},void 0,this),this.__Class=i,this}var s=this.prototype,c=_.toArray(arguments);c.unshift({});var a=_.extend.apply(_,c);e=!0;var o=new this;e=!1,o.__class=!0;var r=o.__keys;o.__keys={},_.each(r,function(t,e){o.__keys[e]=t});for(var u in a)o.__keys[u]=o.__keys[u]||{},o.__keys[u].n=(o.__keys[u].n||0)+1,o.__keys[u].type=typeof a[u],o[u]="function"==typeof a[u]&&n.test(a[u])?function(t,e){return function(){var n=this._super;this._super=s[t];var i=e.apply(this,arguments);return this._super=n,i}}(u,a[u]):a[u];return i.include=function(t){for(var e in t)o.__keys[e]=o.__keys[e]||{},o.__keys[e].n=(o.__keys[e].n||0)+1,o.__keys[e].type=typeof t[e],"function"==typeof t[e]&&n.test(t[e])?"function"==typeof o[e]&&o.hasOwnProperty(e)?o[e]=function(t,e,n){return function(){var t=this._super;this._super=n;var i=e.apply(this,arguments);return this._super=t,i}}(e,t[e],o[e]):"function"==typeof s[e]&&(o[e]=function(t,e){return function(){var n=this._super;this._super=s[t];var i=e.apply(this,arguments);return this._super=n,i}}(e,t[e])):o[e]=t[e]},i.prototype=o,i.constructor=i,i.extend=arguments.callee,"undefined"!=typeof this.extend&&(i.extend=this.extend),i.__class=!0,i.__keys=o.__keys,i}}(GLOBAL);var Socket=Class.extend({http:"http://localhost",socket:null,key:0,callback:{},callbackSync:{},init:function(t){var e=this;this.http=t,this.socket=io.connect(this.http),this.socket.on("socket.server",function(t){var n=e.callback[t.key].callback;_.isFunction(n)&&n(t.e,t.data)}),this.socket.on("socket.server.sync",function(t){try{_.each(e.callbackSync[t.instance],function(t){e.socket.emit("socket.client",{type:t.type,instance:t.instance,func:t.func,args:t.args,key:t.key})},void 0,this)}catch(n){}})},getKey:function(){return this.key++},register:function(t){_.mixObject(t,{type:"pool",instance:null,func:null,args:[],key:this.getKey(),callback:function(){}}),this.callback[t.key]=t,"sync"===t.type&&(void 0===this.callbackSync[t.instance]?this.callbackSync[t.instance]=[]:null,this.callbackSync[t.instance].push(t)),this.socket.emit("socket.client",{type:t.type,instance:t.instance,func:t.func,args:t.args,key:t.key})}}),ekitjs=Class.extend({data:null,socket:null,instance:{},instanceSync:{},instanceEws:{},start:function(t){_.mixObject(t,{instance:{},socket:!1}),this.instance={},this.instanceSync={},this.instanceEws={},_.each(_.encodeObject(t.instance),function(t,e){e=e.split(".");var n=e.pop();e=e.join("."),void 0===this.instance[e]?this.instance[e]={}:null,void 0===this.instanceSync[e]?this.instanceSync[e]={}:null,void 0===this.instanceEws[e]?this.instanceEws[e]={}:null,this.instance[e][n]=!0,this.instanceSync[e][n]=!0,this.instanceEws[e][n]=!0},void 0,this),t.socket!==!1&&(this.socket=new Socket(t.socket.http)),this.setInstance()},setInstance:function(){var t=this;_.each(this.instance,function(e,n){_.each(e,function(i,s){e[s]=function(e,n){return function(){var i=_.initCallback(arguments),s=i.pop();t.socket?t.socket.register({type:"pool",instance:e,func:n,args:i,callback:s}):console.log("socket was disabled from server")}}(n,s)},void 0,this)},void 0,this),_.each(this.instanceSync,function(e,n){_.each(e,function(i,s){e[s]=function(e,n){return function(){var i=_.initCallback(arguments),s=i.pop();t.socket?t.socket.register({type:"sync",instance:e,func:n,args:i,callback:s}):console.log("socket was disabled from server")}}(n,s)},void 0,this)},void 0,this),_.each(this.instanceEws,function(t,e){_.each(t,function(n,i){t[i]=function(t,e){return function(){var n=_.initCallback(arguments),i=n.pop();$.ajax({url:"/ews",type:"post",data:{instance:t,func:e,args:n},success:function(t){i.call(null,t.e,t.data)},error:function(){console.log("ews error.")}})}}(e,i)},void 0,this)},void 0,this)},pool:function(t,e){if(void 0===e)return this.instance[t];try{var n=_.initCallback(arguments);t=n.shift(),e=n.shift(),this.instance[t][e].apply(null,n)}catch(i){console.log("pool call error: ",i),console.log(arguments)}},sync:function(t,e){if(void 0===e)return this.instanceSync[t];try{var n=_.initCallback(arguments);t=n.shift(),e=n.shift(),this.instanceSync[t][e].apply(null,n)}catch(i){console.log("sync call error: ","Unknow instance or method",i),console.log(arguments)}},ews:function(t,e){if(void 0===e)return this.instanceEws[t];try{var n=_.initCallback(arguments);t=n.shift(),e=n.shift(),this.instanceEws[t][e].apply(null,n)}catch(i){console.log("ews call error: ",i),console.log(arguments)}}});ekitjs=new ekitjs,ekitjs.data={instance:{get:{},"web.controller.index":{log:!0,"export":!0},"web.model.menu":{log:!0,getCollection:!0,getDB:!0,createValidate:!0,checkUpdateKey:!0,updateValidate:!0,create:!0,read:!0,update:!0,"delete":!0,createTrigger:!0,updateTrigger:!0,deleteTrigger:!0},"spreadsheet.controller.data":{log:!0,"export":!0}},socket:{url:"http://localhost"}},ekitjs.start(ekitjs.data);